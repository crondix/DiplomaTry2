@using DiplomaModels
@using Microsoft.AspNetCore.Components.Web
@using System.Net.Http.Json
@using System.Text.Json

@page "/test"
@rendermode RenderMode.InteractiveWebAssembly
@inject HttpClient httpClient


<button @onclick="Submit">Click</button>
<div>@message</div>
@if (printers is not null)
{
     <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>Share Name</th>
                    <th>Comment</th>
                    <th>ip</th>
                    <th>Name</th>

                </tr>
            </thead>
             <tbody>
    @foreach (var printer in printers)
    {
         <tr>
                    <td class="align-content-center">@printer.ShareName</td>
                    <td class="align-content-center">@printer.Comment</td>
                    <td class="align-content-center">@printer.Ip</td>
                    @* <td class="align-content-center">@printer.ModelName</td> *@
              

         </tr>
    }
        </tbody>
    </table>
}

@code {
    List<NetworkPrinter>? printers;
    string message;
  
    async Task Submit()
    {
        var response = await httpClient.GetAsync("/printerlist");


        if (response.IsSuccessStatusCode)
        {
            var result = await response.Content.ReadAsStringAsync();
            printers = JsonSerializer.Deserialize<List<NetworkPrinter>>(result);
        }
        else
        {
            var error = await response.Content.ReadFromJsonAsync<Error>();
            if (error != null) message = error.Details;
        }

    }
    class Error
    {
        public string Details { get; set; } = "";
    }
}
